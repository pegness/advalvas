***************
*** 192,202 ****
        $temp_view = $this->getTemporaryView();
  
        // Add the sort from the options to the default display.
-       // This is broken, in that the sort order field also gets added as a
-       // select field. See https://www.drupal.org/node/844910.
-       // We work around this further down.
-       $sort = $options['subquery_sort'];
-       list($sort_table, $sort_field) = explode('.', $sort);
        $sort_options = ['order' => $options['subquery_order']];
        $temp_view->addHandler('default', 'sort', $sort_table, $sort_field, $sort_options);
      }
--- 192,198 ----
        $temp_view = $this->getTemporaryView();
  
        // Add the sort from the options to the default display.
+       list($sort_table, $sort_field) = explode('.', $options['subquery_sort']);
        $sort_options = ['order' => $options['subquery_order']];
        $temp_view->addHandler('default', 'sort', $sort_table, $sort_field, $sort_options);
      }
***************
*** 267,276 ****
      // In the meantime, this works, but with a leap of faith.
      $orders = &$subquery->getOrderBy();
      foreach ($orders as $order_key => $order) {
-       // But if we're using a whole view, we don't know what we have!
-       if ($options['subquery_view']) {
-         list($sort_table, $sort_field) = explode('.', $order_key);
-       }
        $orders[$sort_table . $this->subquery_namespace . '.' . $sort_field] = $order;
        unset($orders[$order_key]);
      }
--- 268,277 ----
      // In the meantime, this works, but with a leap of faith.
      $orders = &$subquery->getOrderBy();
      foreach ($orders as $order_key => $order) {
+       // Until http://drupal.org/node/844910 is fixed, $order_key is a field
+       // alias from SELECT. De-alias it using the View object.
+       $sort_table = $temp_view->query->fields[$order_key]['table'];
+       $sort_field = $temp_view->query->fields[$order_key]['field'];
        $orders[$sort_table . $this->subquery_namespace . '.' . $sort_field] = $order;
        unset($orders[$order_key]);
      }
